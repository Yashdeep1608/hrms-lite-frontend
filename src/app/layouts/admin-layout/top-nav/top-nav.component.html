<!-- Top Navigation Bar -->
<div
  class="flex flex-wrap items-center justify-between px-4 py-2 bg-accent-100 dark:bg-accent-900 text-primary-900 dark:text-gray-50 shadow-sm"
>
  <!-- Left: Sidebar Toggle -->
  <div class="flex items-center">
    <button
      *ngIf="!isSidebarOpen || isMobileView"
      mat-icon-button
      aria-label="Toggle Sidebar"
      (click)="onToggleSidebar()"
      class="mr-2 text-gray-700 dark:text-gray-300 hover:text-accent-600 dark:hover:text-accent-400 transition"
    >
      <mat-icon>menu</mat-icon>
    </button>
  </div>

  <!-- Right: Actions -->
  <div class="flex items-center space-x-3">
    <!-- Credits (always visible) -->
    <div
      id="creditReward"
      matTooltip="Kriyato {{ 'credits' | translate }}"
      aria-label="Credits"
      class="relative flex items-center gap-3 px-3 py-2 rounded-xl bg-gradient-to-r from-yellow-400 via-orange-400 to-amber-500 text-white shadow-md hover:shadow-lg transition cursor-pointer"
    >
      <div
        class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center animate-pulse"
      >
        <mat-icon class="text-white">wallet</mat-icon>
      </div>

      <div class="flex flex-col leading-tight">
        <span class="text-lg font-bold tracking-wide">
          {{ userDetails?.credits || 0 }}
        </span>
      </div>
    </div>

    <!-- Desktop Actions -->
    <div class="hidden md:flex items-center space-x-3">
      <!-- Language -->
      <button
        id="languageButton"
        [matMenuTriggerFor]="languageMenu"
        matTooltip="{{ 'language' | translate }}"
        mat-icon-button
        aria-label="Languages"
        class="relative text-gray-700 dark:text-gray-300 hover:text-accent-600 dark:hover:text-accent-400 transition"
      >
        <mat-icon>translate_indic</mat-icon>
      </button>

      <!-- Notifications -->
      <button
        id="notificationButton"
        [matMenuTriggerFor]="notificationMenu"
        matTooltip="{{ 'notifications' | translate }}"
        mat-icon-button
        aria-label="Notifications"
        class="relative text-gray-700 dark:text-gray-300 hover:text-accent-600 dark:hover:text-accent-400 transition"
      >
        <mat-icon
          matBadge="{{ unreadCount }}"
          matBadgeColor="warn"
          *ngIf="unreadCount > 0"
        >
          notifications
        </mat-icon>
        <mat-icon *ngIf="unreadCount === 0">notifications</mat-icon>
      </button>

      <!-- Support -->
      <button
        mat-icon-button
        id="supportButton"
        matTooltip="{{ 'support' | translate }}"
        aria-label="Help"
        class="text-gray-700 dark:text-gray-300 hover:text-accent-600 dark:hover:text-accent-400 transition"
      >
        <mat-icon>support_agent</mat-icon>
      </button>

      <!-- Business -->
      <button
        mat-icon-button
        id="businessButton"
        matTooltip="{{ 'myBusiness' | translate }}"
        aria-label="My Business"
        class="text-gray-700 dark:text-gray-300 hover:text-accent-600 dark:hover:text-accent-400 transition"
      >
        <mat-icon>business_center</mat-icon>
      </button>

      <!-- Profile -->
      <div
        id="profileAvatar"
        class="cursor-pointer"
        [matMenuTriggerFor]="profileMenu"
      >
        <div
          class="w-10 h-10 rounded-full bg-primary-700 text-primary-100 flex items-center justify-center font-semibold text-md overflow-hidden"
        >
          <ng-container *ngIf="user?.profile_image; else fallbackAvatar">
            <img
              [src]="user.profile_image"
              alt="Profile"
              class="w-full h-full object-cover rounded-full"
            />
          </ng-container>
          <ng-template #fallbackAvatar>
            {{ getInitials(user?.first_name, user?.last_name) }}
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Mobile Actions (Menu Button) -->
    <div class="md:hidden">
      <button
        mat-icon-button
        [matMenuTriggerFor]="mobileMenu"
        class="text-gray-700 dark:text-gray-300 hover:text-accent-600 dark:hover:text-accent-400 transition"
      >
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>
  </div>

  <!-- Mobile Dropdown Menu -->
  <mat-menu #mobileMenu="matMenu">
    <button mat-menu-item [matMenuTriggerFor]="languageMenu">
      <mat-icon>translate_indic</mat-icon>
      <span>{{ "language" | translate }}</span>
    </button>
    <button mat-menu-item [matMenuTriggerFor]="notificationMenu">
      <mat-icon>notifications</mat-icon>
      <span>{{ "notifications" | translate }}</span>
    </button>
    <button mat-menu-item >
      <mat-icon>support_agent</mat-icon>
      <span>{{ "support" | translate }}</span>
    </button>
    <button mat-menu-item>
      <mat-icon>business_center</mat-icon>
      <span>{{ "myBusiness" | translate }}</span>
    </button>
    <button mat-menu-item [matMenuTriggerFor]="profileMenu">
      <mat-icon>account_circle</mat-icon>
      <span>{{ "profile" | translate }}</span>
    </button>
  </mat-menu>
</div>
<!-- Profile Menu -->
<mat-menu
  #profileMenu="matMenu"
  class="!p-0 bg-white dark:bg-primary-900 text-gray-800 dark:text-gray-100 shadow-lg rounded-xl overflow-hidden"
>
  <div class="w-56 py-2 text-sm">
    <!-- Profile Button -->
    <button
      class="w-full flex items-center gap-3 px-4 py-2 hover:bg-gray-100 dark:hover:bg-primary-700 transition-colors"
    >
      <mat-icon class="text-accent-500 dark:text-accent-400">person</mat-icon>
      <span>{{ "profile" | translate }}</span>
    </button>
    <!-- Divider -->
    <hr class="my-3 border-gray-200 dark:border-primary-700" />
    <!-- Logout -->
    <div class="px-3">
      <button
        class="w-full border border-red-500 text-red-600 dark:text-red-400 dark:border-red-400 hover:bg-red-50 dark:hover:bg-red-900 focus:ring-2 focus:ring-red-300 dark:focus:ring-red-600 rounded-lg py-2 px-4 font-medium transition flex items-center justify-center gap-2"
        (click)="onLogout()"
      >
        <mat-icon class="text-red-500 dark:text-red-400">exit_to_app</mat-icon>
        {{ "logout" | translate }}
      </button>
    </div>
  </div>
</mat-menu>

<!-- Notification Menu -->
<mat-menu
  #notificationMenu="matMenu"
  class="!p-0 bg-white dark:bg-primary-900 text-gray-800 dark:text-gray-100 shadow-md rounded-md"
>
  <div class="max-w-xs max-h-96 overflow-auto">
    <div
      class="px-4 py-2 border-b border-gray-200 dark:border-gray-700 font-semibold"
    >
      {{ "notifications" | translate }}
    </div>

    <div
      *ngIf="notifications.length > 0; else noNotifications"
      class="divide-y divide-gray-100 dark:divide-gray-700"
    >
    </div>

    <ng-template #noNotifications>
      <div
        class="px-4 py-4 text-center text-sm text-gray-400 dark:text-gray-500"
      >
        {{ "noNotificationFound" | translate }}
      </div>
    </ng-template>
  </div>
</mat-menu>

<mat-menu
  #languageMenu="matMenu"
  class="!p-0 bg-white dark:bg-primary-900 text-gray-800 dark:text-gray-100 shadow-md rounded-md"
>
  <div class="w-52 py-2 text-sm">
    <button
      class="w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-primary-700 transition-colors"
      (click)="selectedLang = 'en'; changeLang()"
    >
      <span>{{ "english" | translate }}</span>
    </button>
    <button
      class="w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-100 dark:hover:bg-primary-700 transition-colors"
      (click)="selectedLang = 'hi'; changeLang()"
    >
      <span>{{ "hindi" | translate }}</span>
    </button>
  </div>
</mat-menu>
